# Поддержка HTTP/2

FastHTTP поддерживает протокол HTTP/2 для улучшения производительности с серверами, которые его поддерживают. HTTP/2 обеспечивает мультиплексирование, сжатие заголовков и лучшую общую производительность для нескольких одновременных запросов.

## Включение HTTP/2

Просто установите `http2=True` при создании приложения FastHTTP:

```python
from fasthttp import FastHTTP

app = FastHTTP(http2=True)
```

## Установка

Для поддержки HTTP/2 установите с дополнительным пакетом http2:

```bash
pip install fasthttp-client[http2]
```

Это устанавливает необходимые зависимости для поддержки HTTP/2.

## Как это работает

Когда HTTP/2 включен:

1. FastHTTP пытается использовать HTTP/2 для всех запросов
2. Если сервер поддерживает HTTP/2, соединение использует HTTP/2
3. Если сервер не поддерживает HTTP/2, httpx автоматически переключается на HTTP/1.1
4. Изменения в коде не нужны - все обрабатывается автоматически

## Пример

```python
from fasthttp import FastHTTP
from fasthttp.response import Response

app = FastHTTP(http2=True)

@app.get(url="https://www.google.com/")
async def get_google(resp: Response):
    print(f"Status: {resp.status}")
    return resp.status

@app.get(url="https://github.com/")
async def get_github(resp: Response):
    print(f"Status: {resp.status}")
    return resp.status

if __name__ == "__main__":
    app.run()
```

## Важные замечания

### Поддержка сервера

Не все серверы поддерживают HTTP/2. Вот некоторые, которые поддерживают:

- **Google** - https://www.google.com
- **GitHub** - https://github.com
- **YouTube** - https://www.youtube.com
- **Twitter/X** - https://twitter.com

Серверы, которые обычно используют HTTP/1.1:

- **httpbin.org** - https://httpbin.org
- Многие старые веб-сайты
- Некоторые API сервисы

### Автоматическое переключение

Если сервер не поддерживает HTTP/2, httpx автоматически переключается на HTTP/1.1. Вашему коду не нужно обрабатывать это - это происходит прозрачно.

### Преимущества производительности

HTTP/2 обеспечивает наибольшую выгоду, когда:

- Выполняется несколько одновременных запросов к одному серверу
- Сервер поддерживает HTTP/2
- У вас хорошее сетевое соединение

Для одиночных запросов разница в производительности может быть минимальной.

### Редиректы

Некоторые серверы могут перенаправлять с HTTP/2 на HTTP/1.1 во время редиректов. Это нормальное поведение и обрабатывается автоматически.

## Проверка статуса HTTP/2

Вы можете проверить, включен ли HTTP/2 в ваших логах:

```
INFO     │ fasthttp │ ✔ HTTP/2 enabled
```

Когда HTTP/2 включен, httpx будет автоматически использовать HTTP/2 для серверов, которые его поддерживают, и переключаться на HTTP/1.1 для серверов, которые не поддерживают. Переключение происходит прозрачно и автоматически.

**Примечание:** Большинство современных браузеров и HTTP клиентов будут показывать HTTP/2 в инспекторе сети при подключении к серверам, которые его поддерживают. То же самое относится к httpx с включенным HTTP/2.

## Ограничения

1. **Поддержка сервера** - Работает только с серверами, поддерживающими HTTP/2
2. **Поддержка прокси** - Некоторые прокси могут не поддерживать HTTP/2
3. **Тестирование** - Не все службы тестирования HTTP поддерживают HTTP/2

## Устранение неполадок

### HTTP/2 не работает

Если HTTP/2, кажется, не работает:

1. **Проверьте поддержку сервера** - Убедитесь, что сервер действительно поддерживает HTTP/2
2. **Проверьте установку** - Убедитесь, что вы установили с `[http2]`
3. **Проверьте редиректы** - Некоторые серверы перенаправляют на HTTP/1.1
4. **Включите режим отладки** - Используйте `debug=True` для просмотра подробных логов

```python
app = FastHTTP(
    http2=True,
    debug=True  # Смотреть подробные логи
)
```

### Переключение на HTTP/1.1

Если вы видите, что используется HTTP/1.1 вместо HTTP/2:

- Это нормально для серверов, которые не поддерживают HTTP/2
- Переключение происходит автоматически и прозрачно
- Изменения в коде не нужны

---

Для получения дополнительной информации см. раздел [Примеры](examples.md).
